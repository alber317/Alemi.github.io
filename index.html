<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dedicatoria — Para mi persona favorita</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#FFF8FB;
    --card:#ffffff;
    --accent:#F06292;
    --accent-2:#7C4DFF;
    --muted:#5B6270;
    --text:#111827;
    --radius:16px;
    --maxw:980px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    background:linear-gradient(180deg,var(--bg),#fff);
    color:var(--text);
    display:flex;
    justify-content:center;
    padding:28px;
  }

  .site{
    width:100%;
    max-width:var(--maxw);
    background:var(--card);
    border-radius:18px;
    box-shadow:0 18px 60px rgba(20,20,40,0.08);
    overflow:hidden;
  }

  header{
    padding:28px;
    border-bottom:1px solid #f1e8ee;
    background:linear-gradient(90deg,#fff,#fff7fb);
  }
  h1{ margin:0 0 6px; font-size:28px; color:var(--accent-2); }
  .subtitle{ margin:0; color:var(--muted); }

  main{ padding:26px; display:block; gap:18px; }

  .block{
    margin-bottom:20px;
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .text{
    font-size:16px;
    line-height:1.6;
    color:var(--text);
    background:linear-gradient(180deg,#fff,#fff);
    padding:14px 16px;
    border-radius:12px;
  }

  .imgwrap{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
  }
  .imgwrap img{
    border-radius:12px;
    width:200px;
    height:200px;
    object-fit:cover;
    box-shadow:0 10px 30px rgba(20,20,40,0.06);
    transition:transform .35s ease, box-shadow .35s ease;
  }
  .imgwrap img:hover{ transform:translateY(-6px) scale(1.02); box-shadow:0 22px 50px rgba(20,20,40,0.12); }

  .play-area{
    display:flex;
    gap:18px;
    align-items:center;
    padding:18px;
    background:linear-gradient(90deg, rgba(240,240,250,0.6), rgba(255,250,250,0.6));
    border-radius:12px;
  }

  .action-btn{
    background:linear-gradient(180deg,var(--accent),var(--accent-2));
    color:white;
    border:none;
    padding:14px 18px;
    border-radius:12px;
    font-weight:700;
    cursor:pointer;
    font-size:16px;
    box-shadow:0 10px 30px rgba(124,77,255,0.18);
  }
  .action-btn:active{ transform:translateY(2px); }

  .heart{
    width:72px;
    height:72px;
    display:grid;
    place-items:center;
    border-radius:12px;
    background:rgba(240,240,250,0.6);
    position:relative;
    overflow:visible;
  }

  .heart svg{ width:56px; height:56px; transform-origin:center; opacity:0; }

  .lyrics{
    flex:1;
    min-height:70px;
    padding:12px;
    border-radius:10px;
    background:linear-gradient(180deg,#fff,#fff);
    box-shadow:inset 0 1px 0 rgba(0,0,0,0.02);
    font-weight:600;
    color:var(--muted);
  }
  .line{ opacity:0; transform:translateY(6px); transition:all .4s ease; margin:6px 0; color:var(--text) }

  .line.visible{ opacity:1; transform:translateY(0); }
  
  /* FIX ESTILO: Aplica el color degradado a las letras usando tus variables */
  .line {
    background: linear-gradient(90deg, var(--accent), var(--accent-2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    color: transparent;
    font-weight:700;
    font-size:17px;
    text-shadow: 0 1px 0 rgba(0,0,0,0.04);
  }
  .line.visible { 
    opacity:1;
    transform:translateY(0);
    transition: opacity .45s ease, transform .45s ease;
  }

  footer{ padding:16px; font-size:13px; color:var(--muted); border-top:1px solid #f3eef3; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:8px; }

  @media (max-width:760px){
    .imgwrap img{ width:48%; height:140px; }
    .heart{ width:56px; height:56px; }
    .heart svg{ width:44px; height:44px; }
  }

  /* FIX IMAGENES: Regla para que las imágenes únicas anchas se adapten en móvil */
  @media (max-width: 480px) {
    .imgwrap img:only-child {
      width: 100%;
      height: auto;
      max-width: 100%;
    }
  }

  @keyframes heart-pop {
    0% { transform: scale(0.2); opacity:0; filter:blur(6px); }
    40% { transform: scale(1.14); opacity:1; filter:blur(0); }
    70% { transform: scale(.92); }
    100% { transform: scale(1); opacity:1; }
  }

  @keyframes heart-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.06); }
    100% { transform: scale(1); }
  }

  .heart svg.show {
    animation: heart-pop .55s ease forwards, heart-pulse 1.2s 0.6s ease-in-out infinite;
  }

  /* pequeño hint de debug (agregado para ayudar a diagnosticar errores) */
  #debugHint { position:fixed; right:12px; bottom:12px; z-index:9999; background:rgba(0,0,0,0.6); color:#fff; padding:8px 10px; border-radius:8px; font-size:13px; display:none; }
  #debugHint.show { display:block; }

</style>
</head>
<body>
  <div class="site" id="site">
    <header>
      <h1 id="pageTitle">Para mi persona favorita</h1>
      <p class="subtitle" id="pageSub">Espero que te guste</p>
    </header>

    <main id="mainContent">

      <section class="block">
        <div class="text" id="para1">
          Nunca creí encontrar una persona con la cual puedo llegar a ser yo mismo sin sentir pena o vergüenza pues de todas las casualidades del Universo, la mejor fue coincidir **contigo**, y nosotros siempre seremos como:
        </div>
      </section>

      <section class="block">
        <div class="imgwrap" id="imgs1">
          <img src="https://images5.alphacoders.com/132/1326575.png" alt="imagen1">
        </div>
      </section>

      <section class="block">
        <div class="text" id="para2">
          A pesar de los problemas o peleas nunca nos dejamos de hablar porque para mi eres muy importante y no puedo imaginar mi **día a día** sin hablar contigo
        </div>
      </section>

      <section class="block">
        <div class="imgwrap" id="imgs2">
          <img src="https://i.pinimg.com/736x/57/56/cf/5756cf550e06ceaa5ed63526d59d9af0.jpg" alt="imagen2">
          <img src="https://i.pinimg.com/280x280_RS/b3/40/e7/b340e7fe543acb710569dcbfe776bafe.jpg" alt="imagen3">
        </div>
      </section>

      <section class="block">
        <div class="text" id="para3">
          Aunque aun me falte mucho mas que aprender o conocer sobre ti, siempre me **encantará** la idea de saber las cosas que te hacen reir, llorar, las cosas que te preocupan, tus problemas, tus sueños, y mucho mas
          <br><br>
          Espero que en este nuevo año sigamos hablando como siempre, y nunca separarnos por un 2026 lleno de nuevas Historias
        </div>
      </section>

      <section class="block">
        <div class="imgwrap" id="imgs3">
          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS4CYoBDZu6Cd8eag_bUXe-coZBeHFgXa6xAr1_wSnn56ql_IO_T2BQJ6vcQ5MS_GMOcrw" alt="imagen4">
        </div>
      </section>

      <section class="block">
        <div class="play-area">
          <div class="heart" id="heartBox" title="Se mostrará un corazón">
            <svg id="heartSvg" viewBox="0 0 32 29.6" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path fill="url(#g)" d="M23.6 0c-2.7 0-5 1.5-6.6 3.8C15.4 1.5 13.1 0 10.4 0 4.7 0 0 4.8 0 10.8 0 18.6 9.6 23.6 16 29.6c6.4-6 16-11 16-18.8C32 4.8 27.3 0 21.6 0z"/>
              <defs>
                <linearGradient id="g" x1="0" x2="1">
                  <stop offset="0" stop-color="#ff5a97"/>
                  <stop offset="1" stop-color="#7C4DFF"/>
                </linearGradient>
              </defs>
            </svg>
          </div>

          <button class="action-btn" id="playBtn">Apreta aquí</button>

          <div class="lyrics" id="lyricsBox">
            <div id="linesContainer"></div>
          </div>
        </div>

        <audio id="track" preload="metadata">
                    <source id="audioSrc" src="https://raw.githubusercontent.com/alber317/Alemi.github.io/main/Ricky%20Montgomery%20-%20Mr%20Loverman%20(Official%20Lyric%20Video).mp3" type="audio/mpeg">
          Tu navegador no soporta reproducción de audio.
        </audio>

      </section>

    </main>

    <footer>
      <div>Hecho con ❤️</div>
      <div style="font-size:12px;color:var(--muted)">Alemi</div>
    </footer>
  </div>

  <div id="debugHint" role="status" aria-live="polite"></div>

<script>
  
  /* === CONFIGURACIÓN Y DATOS === */
  const RAW_GITHUB_URL_OVERRIDE = 'https://raw.githubusercontent.com/alber317/Alemi.github.io/main/Ricky%20Montgomery%20-%20Mr%20Loverman%20(Official%20Lyric%20Video).mp3';
  const DEFAULT_AUDIO_FILENAME = 'mister-loverman.mp3';
  const defaultDelayBetweenLines = 2000; // ms de fallback

  // FIX SINCRONIZACIÓN: Timestamps (tiempo en segundos) añadidos para Mr. Loverman
  const lyricsData = [
    { time: 4.6, text: "I'm headed straight for the floor" },
    { time: 8.2, text: "The alcohol served its tour" },
    { time: 11.9, text: "And it's headed straight for my skin" },
    { time: 15.6, text: "Leaving me daft and dim" },
    { time: 19.3, text: "I've got this shake in my legs" },
    { time: 23.1, text: "Shaking the thoughts from my head" },
    { time: 26.8, text: "But who put these waves in the door?" },
    { time: 30.5, text: "I crack and out I pour" },
    { time: 34.3, text: "I'm Mr. Loverman" },
    { time: 38.0, text: "And I miss my lover, man" },
    { time: 41.7, text: "I'm Mr. Loverman" },
    { time: 45.4, text: "Oh, and I miss my lover" },
    { time: 49.2, text: "The ways in which you talk to me" },
    { time: 52.9, text: "Have me wishin' I were gone" },
    { time: 56.6, text: "The ways that you say my name" },
    { time: 60.3, text: "Have me runnin' on and on" },
    { time: 64.0, text: "Oh, I'm cramping up, I'm cramping up" },
    { time: 67.8, text: "But you're cracking up, you're cracking up" },
    { time: 71.4, text: "I'm Mr. Loverman" },
    { time: 75.1, text: "And I miss my loverman" },
    { time: 78.8, text: "I'm Mr. Loverman" },
    { time: 82.5, text: "Oh, and I miss my lover" },
    { time: 94.2, text: "I've shattered now, I'm spilling out" },
    { time: 97.9, text: "Upon this linoleum ground (Mr. Loverman)" },
    { time: 101.5, text: "I'm reeling in my brain again" },
    { time: 105.3, text: "Before it can get back to you (Mr. Loverman)" },
    { time: 109.0, text: "Oh, what am I supposed to do without you?" },
    { time: 112.7, text: "I'm Mr. Loverman" },
    { time: 116.4, text: "And I miss my lover, man (I miss my lover)" },
    { time: 120.1, text: "I'm Mr. Loverman (oh-oh)" },
    { time: 123.8, text: "Oh, and I miss my lover (Mr. Loverman)" },
    { time: 127.5, text: "I'm Mr. Loverman" }
  ];


(function(){
  
  /* === DOM refs === */
  const btn = document.getElementById('playBtn');
  const heartSvg = document.getElementById('heartSvg');
  const audioEl = document.getElementById('track');
  const audioSrc = document.getElementById('audioSrc');
  const linesContainer = document.getElementById('linesContainer');
  const debugEl = document.getElementById('debugHint');
  
  /* --- util debug en pantalla --- */
  function showDebug(msg, isError){
    if(!debugEl) return;
    debugEl.textContent = msg;
    debugEl.classList.add('show');
    debugEl.style.background = isError ? 'rgba(160,20,20,0.9)' : 'rgba(0,0,0,0.6)';
    setTimeout(()=> debugEl.classList.remove('show'), 5000);
    console[isError?'error':'log']('[PAGE]', msg);
  }

  /* --- detectar/cargar audio --- */
  function buildRawGuess(){
    try {
      const host = location.hostname;
      let user = null;
      if (host.endsWith('github.io')) user = host.split('.')[0];
      const pathParts = location.pathname.split('/').filter(Boolean);
      const repoGuess = pathParts[0] || (user ? user + '.github.io' : null);
      if(user && repoGuess){
        return 'https://raw.githubusercontent.com/' + user + '/' + repoGuess + '/main/' + DEFAULT_AUDIO_FILENAME;
      }
    } catch(e){}
    return '';
  }

  function detectAudioSrc(){
    // Usa la URL definida al principio
    if (RAW_GITHUB_URL_OVERRIDE && RAW_GITHUB_URL_OVERRIDE.trim().length>0) return RAW_GITHUB_URL_OVERRIDE;
    
    if (audioSrc && audioSrc.getAttribute('data-src') && audioSrc.getAttribute('data-src').trim().length>0) return audioSrc.getAttribute('data-src');
    
    // Usa el src si es válido y no el placeholder
    if (audioSrc && audioSrc.src && audioSrc.src.trim().length>0 && !audioSrc.src.includes('ejemplo.com')) return audioSrc.src;
    
    const guess = buildRawGuess();
    if (guess) return guess;
    return '';
  }

  (function setAudio(){
    const src = detectAudioSrc();
    if (src && src.trim().length>0){
      if(audioSrc){
        audioSrc.setAttribute('data-src', src);
        audioSrc.src = src;
        try { audioEl.load(); } catch(e){ console.warn('audio load failed', e); }
        showDebug('Audio cargado.');
      }
    } else {
      showDebug('No se encontró audio: la URL no está definida o es inválida.', true);
    }
  })();
  
  /* === preparar y pintar líneas === */
  function setupLines(lines){
    linesContainer.innerHTML = '';
    const arr = Array.isArray(lines) && lines.length ? lines : lyricsData || [];
    if(!arr || arr.length===0){
      const hint = document.createElement('div');
      hint.style.opacity = .6;
      hint.textContent = 'Las letras no fueron cargadas. Revisa el array lyricsData.';
      linesContainer.appendChild(hint);
      return;
    }
    arr.forEach((ln, idx) => {
      const d = document.createElement('div');
      d.className = 'line';
      d.dataset.idx = idx;
      d.textContent = ln.text || '';
      d.style.color = 'var(--accent)'; // Fallback
      linesContainer.appendChild(d);
    });
  }
  setupLines(lyricsData);

  /* === animaciones === */
  function animateHeart(){
    if(!heartSvg) return;
    heartSvg.classList.remove('show');
    void heartSvg.offsetWidth;
    heartSvg.classList.add('show');
  }

  function revealSequentialByInterval(intervalMs){
    const nodes = Array.from(document.querySelectorAll('.line'));
    nodes.forEach((el, idx) => {
      setTimeout(()=> el.classList.add('visible'), Math.max(0, Math.round(idx * intervalMs)));
    });
  }

  function revealByTimestampsFromArray(arr){
    // Limpia todas las líneas al empezar a escuchar el audio
    document.querySelectorAll('.line').forEach(x=> x.classList.remove('visible'));
    
    // Función que se ejecuta con cada actualización de tiempo del audio
    const timestampHandler = function(){
      const t = audioEl.currentTime;
      arr.forEach((ln, idx) => {
        // Solo si tiene tiempo definido Y si el tiempo actual es mayor/igual al tiempo de la línea
        if (ln.time !== undefined && t >= ln.time){
          const el = document.querySelector('.line[data-idx="'+idx+'"]');
          if (el && !el.classList.contains('visible')) el.classList.add('visible');
        }
      });
      // Detener la sincronización cuando termina el audio
      if (audioEl.ended) {
          audioEl.removeEventListener('timeupdate', timestampHandler);
      }
    };
    audioEl.addEventListener('timeupdate', timestampHandler);
  }

  /* === click handler robusto === */
  if(!btn || !audioEl){ showDebug('Elementos principales (botón/audio) faltan.', true); return; }

  btn.addEventListener('click', async function(){
    btn.disabled = true;
    btn.style.opacity = '0.85';

    // 1) Animación del corazón primero
    animateHeart();

    await new Promise(r=> setTimeout(r, 420));

    // 2) Intentar reproducir audio
    const hasAudio = audioEl && audioEl.src && audioEl.src.trim().length>0 && !audioEl.src.includes('ejemplo.com');
    
    if (hasAudio){
      
      // Intenta cargar metadata si no está lista
      if (!audioEl.duration || isNaN(audioEl.duration) || audioEl.duration === Infinity){
        await new Promise(resolve => {
          const onMeta = ()=> { audioEl.removeEventListener('loadedmetadata', onMeta); resolve(); };
          audioEl.addEventListener('loadedmetadata', onMeta);
          setTimeout(resolve, 3000); // Falla segura
        });
      }

      try { audioEl.currentTime = 0; } catch(e){ /* ignore */ }

      try {
        const playPromise = audioEl.play();
        if (playPromise !== undefined) await playPromise;
        showDebug('Audio reproduciéndose y letras sincronizadas.');
      } catch(err){
        console.warn('Play rejected:', err);
        showDebug('No se pudo reproducir audio (Error de navegador). Mostrando letras automáticas.', true);
        // Si falla la reproducción (común en Chrome sin interacción previa), se muestra el texto automáticamente
        const interval = defaultDelayBetweenLines;
        revealSequentialByInterval(interval);
        btn.disabled = false;
        btn.style.opacity = '1';
        return;
      }

      // 3) Muestra las letras con los timestamps exactos
      const arr = lyricsData;
      const hasTimes = arr.some(x => x && x.time !== undefined);

      if (hasTimes){
        revealByTimestampsFromArray(arr);
      } else {
        // Fallback por si borras los tiempos
        const totalDuration = audioEl.duration && !isNaN(audioEl.duration) ? audioEl.duration : null;
        const linesCount = document.querySelectorAll('.line').length || arr.length || 1;
        if (totalDuration && linesCount>0){
          const intervalMs = Math.max(300, Math.floor((totalDuration * 1000) / linesCount));
          revealSequentialByInterval(intervalMs);
        } else {
          revealSequentialByInterval(defaultDelayBetweenLines);
        }
      }

    } else {
      // No hay audio: solo muestra letras con retardo fijo
      showDebug('No hay audio configurado — mostrando texto solamente.');
      const arr = lyricsData;
      if (arr.length) revealSequentialByInterval(defaultDelayBetweenLines);
    }

    // Re-habilita el botón (para que pueda volver a reproducir al recargar la página)
    setTimeout(()=> { btn.disabled=false; btn.style.opacity='1'; }, 3000);
  });

  showDebug('Script cargado — pulsa el botón.');

})();
</script>
</body>
</html>
